name: Build APK
on: push
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-java@v3
      with:
        java-version: '11'
        distribution: 'temurin'
    - run: |
        mkdir -p app
        cat > app/build.gradle.kts << 'EOF'
        plugins {
            id("com.android.application")
            kotlin("android")
        }
        android {
            compileSdk = 33
            defaultConfig {
                applicationId = "com.example.dcacalculator"
                minSdk = 21
                targetSdk = 33
            }
            buildTypes {
                release { isMinifyEnabled = false }
            }
            compileOptions {
                sourceCompatibility = JavaVersion.VERSION_1_8
                targetCompatibility = JavaVersion.VERSION_1_8
            }
            kotlinOptions { jvmTarget = "1.8" }
            buildFeatures { compose = true }
            composeOptions { kotlinCompilerExtensionVersion = "1.4.3" }
        }
        dependencies {
            implementation("androidx.core:core-ktx:1.10.1")
            implementation("androidx.activity:activity-compose:1.7.2")
            implementation("androidx.compose.ui:ui")
            implementation("androidx.compose.material3:material3")
        }
        EOF
    - run: gradle wrapper --gradle-version 8.0
    - run: ./gradlew assembleDebug
    - uses: actions/upload-artifact@v4
      with:
        name: app
        path: app/build/outputs/apk/debug/app-debug.apk
